<p><link rel="stylesheet" href="http://jasonm23.github.io/markdown-css-themes/swiss.css"></p>
<h1 id="-08-angularjs-https-mooxe000-github-io-angularjstutorial_cn-"><a href="https://Mooxe000.github.io/AngularjsTutorial_cn">08. AngularJS 链接与图片模板</a></h1>
<p>这一步，你会为手机列表的手机添加缩略图以及一些链接，不过这些链接还不会起作用。接下来你会使用这些链接来分类显示手机的额外信息。</p>
<p>请重置工作目录：</p>
<pre><code>git checkout -f step-6
</code></pre><p>现在你应该能够看到列表里面手机的图片和链接了。</p>
<p>步骤5和步骤6之间最重要的不同在下面列出。你可以在<a href="https://github.com/angular/angular-phonecat/compare/step-5...step-6">GitHub</a>里看到完整的差别。</p>
<h3 id="-">数据</h3>
<p>注意到现在<code>phones.json</code>文件包含了唯一标识符和每一部手机的图像链接。这些url现在指向<code>app/img/phones/</code>目录。</p>
<p><strong>app/phones/phones.json</strong>（样例片段）</p>
<pre><code>[
 {
  ...
  &quot;id&quot;: &quot;motorola-defy-with-motoblur&quot;,
  &quot;imageUrl&quot;: &quot;img/phones/motorola-defy-with-motoblur.0.jpg&quot;,
  &quot;name&quot;: &quot;Motorola DEFY\u2122 with MOTOBLUR\u2122&quot;,
  ...
 },
...
]
</code></pre><h3 id="-">模板</h3>
<p><strong>app/index.html</strong></p>
<pre><code>...
        &lt;ul class=&quot;phones&quot;&gt;
          &lt;li ng-repeat=&quot;phone in phones | filter:query | orderBy:orderProp&quot; class=&quot;thumbnail&quot;&gt;
            &lt;a href=&quot;#/phones/{{phone.id}}&quot; class=&quot;thumb&quot;&gt;&lt;img ng-src=&quot;{{phone.imageUrl}}&quot;&gt;&lt;/a&gt;
            &lt;a href=&quot;#/phones/{{phone.id}}&quot;&gt;{{phone.name}}&lt;/a&gt;
            &lt;p&gt;{{phone.snippet}}&lt;/p&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
...
</code></pre><p>这些链接将来会指向每一部电话的详细信息页。不过现在为了产生这些链接，我们在<code>href</code>属性里面使用我们早已熟悉的双括号数据绑定。在步骤2，我们添加了<code>{{phone.name}}</code>绑定作为元素内容。在这一步，我们在元素属性中使用<code>{{phone.id}}</code>绑定。</p>
<p>我们同样为每条记录添加手机图片，只需要使用<a href="http://code.angularjs.org/1.1.0/docs/api/ng.directive:ngSrc">ngSrc</a>指令代替<code>&lt;img&gt;</code>的<code>src</code>属性标签就可以了。如果我们仅仅用一个正常<code>src</code>属性来进行绑定（<code>&lt;img class=&quot;diagram&quot; src=&quot;{{phone.imageUrl}}&quot;&gt;</code>），浏览器会把AngularJS的<code>{{ 表达式 }}</code>标记直接进行字面解释，并且发起一个向非法url<code>http://localhost:8000/app/{{phone.imageUrl}}</code>的请求。因为浏览器载入页面时，同时也会请求载入图片，AngularJS在页面载入完毕时才开始编译——浏览器请求载入图片时<code>{{phone.imageUrl}}</code>还没得到编译！有了这个<code>ngSrc</code>指令会避免产生这种情况，使用<code>ngSrc</code>指令防止浏览器产生一个指向非法地址的请求。</p>
<h3 id="-">测试</h3>
<p><strong>test/e2e/scenarios.js</strong></p>
<pre><code>...
    it(&#39;should render phone specific links&#39;, function() {
      input(&#39;query&#39;).enter(&#39;nexus&#39;);
      element(&#39;.phones li a&#39;).click();
      expect(browser().location().url()).toBe(&#39;/phones/nexus-s&#39;);
    });
...
</code></pre><p>我们添加了一个新的端到端测试来验证应用为手机视图产生了正确的链接，上面就是我们的实现。</p>
<p>你现在可以刷新你的浏览器，并且用端到端测试器来观察测试的运行，或者你可以在<a href="http://angular.github.com/angular-phonecat/step-6/test/e2e/runner.html">AngularJS服务器</a>上运行它们。</p>
<h2 id="-">练习</h2>
<p>将<code>ng-src</code>指令换成普通的<code>src</code>属性。用像Firebug，Chrome Web Inspector这样的工具，或者直接去看服务器的访问日志，你会发现你的应用向<code>/app/%7B%7Bphone.imageUrl%7D%7D</code>（或者<code>/app/{{phone.imageUrl}}</code>）发送了一个非法请求。</p>
<p>这个问题是由于浏览器会在遇到<code>img</code>标签的时候立刻向还未得到编译的URL地址发送一个请求，AngularJS只有在页面载入完毕后才开始编译表达式从而得到正确的图片URL地址。</p>
<h2 id="-">总结</h2>
<p>如今你已经添加了手机图片和链接，转到<a href="http://angularjs.cn/A00a">步骤7</a>，我们将学习AngularJS的布局模板以及AngularJS是如何轻易地为应用提供多重视图。</p>
